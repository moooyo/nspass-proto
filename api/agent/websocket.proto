syntax = "proto3";

package nspass.api.agent.v1;

option go_package = "github.com/moooyo/nspass-proto/generated/api/agent;agent";

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "model/websocket.proto";
import "model/node.proto";


// Agent WebSocketæœåŠ¡
// 
// WebSocketé€šä¿¡åè®®è¯´æ˜ï¼š
// ====================================================================
//
// ğŸ”— è¿æ¥å»ºç«‹ï¼š
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚ WebSocket URL: ws://server:port/ws?agent_id={id}&token={token}   â”‚
// â”‚ æˆ–ä½¿ç”¨Header: Authorization: Bearer {token}                     â”‚
// â”‚ æ•°æ®æ ¼å¼: Protocol Buffers äºŒè¿›åˆ¶ (websocket.BinaryMessage)      â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
//
// ğŸ“¨ æ¶ˆæ¯ç»“æ„ï¼š
// æ‰€æœ‰æ¶ˆæ¯éƒ½åŸºäº nspass.model.v1.WebSocketMessage ç»“æ„ï¼š
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚ message WebSocketMessage {                                      â”‚
// â”‚   string id = 1;              // ä¼ è¾“å±‚æ¶ˆæ¯IDï¼ˆéšæœºç”Ÿæˆï¼‰        â”‚
// â”‚   WebSocketMessageType type = 2; // æ¶ˆæ¯ç±»å‹                    â”‚ 
// â”‚   Timestamp timestamp = 3;    // æ—¶é—´æˆ³                        â”‚
// â”‚   Any payload = 4;           // ä¸šåŠ¡æ•°æ®                       â”‚
// â”‚   string correlation_id = 5; // ä¸šåŠ¡å…³è”IDï¼ˆä»»åŠ¡IDï¼‰           â”‚
// â”‚ }                                                               â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
//
// ğŸ¯ æ ¸å¿ƒæœºåˆ¶ - IDåˆ†å±‚è®¾è®¡ï¼š
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚ âœ… æ­£ç¡®çš„IDä½¿ç”¨æ–¹å¼ï¼š                                            â”‚
// â”‚                                                                â”‚
// â”‚ 1. å‘é€ä»»åŠ¡ï¼š                                                   â”‚
// â”‚    WebSocketMessage.id = "msg_1691234567890"    // ä¼ è¾“å±‚ID    â”‚
// â”‚    WebSocketMessage.correlation_id = "task_123" // ä¸šåŠ¡å±‚ID    â”‚
// â”‚    TaskMessage.task_id = "task_123"            // ä»»åŠ¡ID      â”‚
// â”‚                                                                â”‚
// â”‚ 2. ACKå“åº”ï¼š                                                   â”‚
// â”‚    WebSocketMessage.id = "msg_1691234567891"    // æ–°æ¶ˆæ¯ID    â”‚
// â”‚    WebSocketMessage.correlation_id = "task_123" // åŸä»»åŠ¡ID âœ… â”‚
// â”‚    AckMessage.message_id = "msg_1691234567890"  // åŸæ¶ˆæ¯ID    â”‚
// â”‚                                                                â”‚
// â”‚ 3. åç«¯å¤„ç†ï¼š                                                   â”‚
// â”‚    taskID := msg.CorrelationId  // âœ… ä½¿ç”¨correlation_id      â”‚
// â”‚    // âŒ é”™è¯¯ï¼štaskID := ackMsg.MessageId                      â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
//
// ğŸ”„ ä»»åŠ¡æ‰§è¡Œæµç¨‹ï¼š
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚ åç«¯ â†’ Agent: å‘é€ä»»åŠ¡                                           â”‚
// â”‚ â”œâ”€ type: WEBSOCKET_MESSAGE_TYPE_TASK                           â”‚
// â”‚ â”œâ”€ correlation_id: task_id                                     â”‚
// â”‚ â””â”€ payload: TaskMessage                                        â”‚
// â”‚                                                                â”‚
// â”‚ Agent â†’ åç«¯: ACKå“åº”                                           â”‚
// â”‚ â”œâ”€ type: WEBSOCKET_MESSAGE_TYPE_ACK                            â”‚
// â”‚ â”œâ”€ correlation_id: åŸä»»åŠ¡ID âš ï¸ å¿…é¡»è®¾ç½®                        â”‚
// â”‚ â””â”€ payload: AckMessage(å«TaskResult)                           â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
//
// âš ï¸ é‡è¦çº¦å®šï¼š
// 1. Agentå¿…é¡»åœ¨ACKçš„correlation_idä¸­è¿”å›åŸä»»åŠ¡ID
// 2. åç«¯é€šè¿‡correlation_idè€Œémessage_idè·å–ä»»åŠ¡ID
// 3. ç¼ºå°‘correlation_idçš„ACKå°†è¢«æ‹’ç»å¤„ç†
//
// ğŸ” æœåŠ¡å™¨è®¤è¯çº¦å®šï¼š
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚ HTTP APIè®¤è¯:                                                   â”‚
// â”‚   Header: Server-ID = <æœåŠ¡å™¨ID>                                â”‚
// â”‚   Header: Server-Token = <æœåŠ¡å™¨Token>                          â”‚
// â”‚                                                                â”‚
// â”‚ gRPC APIè®¤è¯:                                                   â”‚
// â”‚   Metadata: server-id = <æœåŠ¡å™¨ID>                              â”‚
// â”‚   Metadata: server-token = <æœåŠ¡å™¨Token>                        â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
//
// è¯¦ç»†çš„è®¤è¯çº¦å®šå‚è§: nspass.model.v1.ServerAuthHeaders (å®šä¹‰åœ¨ model/auth.proto)

service AgentWebSocketService {
  // å»ºç«‹WebSocketè¿æ¥
  // 
  // æ­¤ç«¯ç‚¹æä¾›WebSocketè¿æ¥å»ºç«‹çš„HTTPå‡çº§å…¥å£ã€‚
  // å®é™…çš„WebSocketé€šä¿¡ä½¿ç”¨Protocol BuffersäºŒè¿›åˆ¶æ ¼å¼ï¼Œ
  // æ‰€æœ‰æ¶ˆæ¯éƒ½åŸºäºWebSocketMessageç»“æ„ï¼Œä½¿ç”¨correlation_idè¿›è¡Œä¸šåŠ¡å…³è”ã€‚
  // 
  // WebSocketè¿æ¥å»ºç«‹åï¼Œä»»åŠ¡å‘é€å’ŒACKå“åº”éƒ½é€šè¿‡WebSocketè¿›è¡Œï¼Œ
  // è€Œä¸æ˜¯é€šè¿‡ä¸‹é¢çš„HTTP APIç«¯ç‚¹ã€‚
  rpc Connect(ConnectRequest) returns (ConnectResponse) {
    option (google.api.http) = {
      get: "/v1/agent/websocket"
    };
  };
  
  // å‘é€ä»»åŠ¡ç»™Agent
  //
  // æ³¨æ„ï¼šå®é™…çš„ä»»åŠ¡å‘é€æ˜¯é€šè¿‡WebSocketè¿æ¥è¿›è¡Œçš„ï¼Œæ­¤HTTP APIä»…ç”¨äºæµ‹è¯•æˆ–ç®¡ç†ç›®çš„ã€‚
  // çœŸå®çš„ä»»åŠ¡å‘é€æµç¨‹ï¼š
  // 1. åç«¯é€šè¿‡WebSocketå‘é€TaskMessageï¼Œè®¾ç½®correlation_idä¸ºä»»åŠ¡ID
  // 2. Agenté€šè¿‡WebSocketè¿”å›AckMessageï¼Œåœ¨å¤–å±‚WebSocketMessage.correlation_idä¸­è®¾ç½®ä»»åŠ¡ID
  // 3. åç«¯é€šè¿‡correlation_idè·å–ä»»åŠ¡IDå¹¶æ›´æ–°çŠ¶æ€
  rpc SendTask(SendTaskRequest) returns (SendTaskResponse) {
    option (google.api.http) = {
      post: "/v1/agent/ws/tasks"
      body: "*"
    };
  };
  
  // è·å–AgentçŠ¶æ€
  rpc GetAgentStatus(GetAgentStatusRequest) returns (GetAgentStatusResponse) {
    option (google.api.http) = {
      get: "/v1/agent/{agent_id}/status"
    };
  };
  
  // è·å–ä»»åŠ¡åˆ—è¡¨
  rpc ListTasks(ListTasksRequest) returns (ListTasksResponse) {
    option (google.api.http) = {
      get: "/v1/agent/ws/tasks"
    };
  };
  
  // è·å–ä»»åŠ¡è¯¦æƒ…
  rpc GetTask(GetTaskRequest) returns (GetTaskResponse) {
    option (google.api.http) = {
      get: "/v1/agent/ws/tasks/{task_id}"
    };
  };
  
  // å–æ¶ˆä»»åŠ¡
  rpc CancelTask(CancelTaskRequest) returns (CancelTaskResponse) {
    option (google.api.http) = {
      delete: "/v1/agent/ws/tasks/{task_id}"
    };
  };
  
  // è·å–ç›‘æ§æ•°æ®
  rpc GetMetrics(GetMetricsRequest) returns (GetMetricsResponse) {
    option (google.api.http) = {
      get: "/v1/agent/ws/metrics"
    };
  };
  
  // è·å–ç›‘æ§æ•°æ®å†å²
  rpc GetMetricsHistory(GetMetricsHistoryRequest) returns (GetMetricsHistoryResponse) {
    option (google.api.http) = {
      get: "/v1/agent/ws/metrics/history"
    };
  };
}

// è¿æ¥è¯·æ±‚
message ConnectRequest {
  string agent_id = 1;                             // Agent ID
  string token = 2;                                // è®¤è¯Token
  string version = 3;                              // Agentç‰ˆæœ¬
  map<string, string> metadata = 4;               // å…ƒæ•°æ®
}

// è¿æ¥å“åº”
message ConnectResponse {
  bool success = 1;                                // æ˜¯å¦æˆåŠŸ
  string session_id = 2;                           // ä¼šè¯ID
  string error_message = 3;                        // é”™è¯¯ä¿¡æ¯
  google.protobuf.Timestamp connected_at = 4;     // è¿æ¥æ—¶é—´
  map<string, string> server_info = 5;            // æœåŠ¡å™¨ä¿¡æ¯
}

// å‘é€ä»»åŠ¡è¯·æ±‚
message SendTaskRequest {
  string agent_id = 1;                             // Agent ID
  nspass.model.v1.TaskMessage task = 2;           // ä»»åŠ¡æ¶ˆæ¯
}

// å‘é€ä»»åŠ¡å“åº”
message SendTaskResponse {
  bool success = 1;                                // æ˜¯å¦æˆåŠŸ
  string task_id = 2;                              // ä»»åŠ¡ID
  string error_message = 3;                        // é”™è¯¯ä¿¡æ¯
}

// è·å–AgentçŠ¶æ€è¯·æ±‚
message GetAgentStatusRequest {
  string agent_id = 1;                             // Agent ID
}

// è·å–AgentçŠ¶æ€å“åº”
message GetAgentStatusResponse {
  string agent_id = 1;                             // Agent ID
  nspass.model.v1.NodeStatus status = 2;          // çŠ¶æ€
  google.protobuf.Timestamp last_heartbeat = 3;   // æœ€åå¿ƒè·³æ—¶é—´
  google.protobuf.Timestamp connected_at = 4;     // è¿æ¥æ—¶é—´
  bool is_connected = 5;                           // æ˜¯å¦è¿æ¥
  string session_id = 6;                           // ä¼šè¯ID
  map<string, string> metadata = 7;               // å…ƒæ•°æ®
}

// è·å–ä»»åŠ¡åˆ—è¡¨è¯·æ±‚
message ListTasksRequest {
  string agent_id = 1;                             // Agent ID
  nspass.model.v1.TaskStatus status = 2;          // ä»»åŠ¡çŠ¶æ€è¿‡æ»¤
  int32 page = 3;                                  // é¡µç 
  int32 page_size = 4;                             // æ¯é¡µå¤§å°
  google.protobuf.Timestamp start_time = 5;       // å¼€å§‹æ—¶é—´
  google.protobuf.Timestamp end_time = 6;         // ç»“æŸæ—¶é—´
}

// è·å–ä»»åŠ¡åˆ—è¡¨å“åº”
message ListTasksResponse {
  repeated TaskInfo tasks = 1;                     // ä»»åŠ¡åˆ—è¡¨
  int32 total = 2;                                 // æ€»æ•°
  int32 page = 3;                                  // å½“å‰é¡µ
  int32 page_size = 4;                             // æ¯é¡µå¤§å°
}

// ä»»åŠ¡ä¿¡æ¯
message TaskInfo {
  string task_id = 1;                              // ä»»åŠ¡ID
  string agent_id = 2;                             // Agent ID
  nspass.model.v1.TaskType task_type = 3;         // ä»»åŠ¡ç±»å‹
  string title = 4;                                // ä»»åŠ¡æ ‡é¢˜
  string description = 5;                          // ä»»åŠ¡æè¿°
  nspass.model.v1.TaskStatus status = 6;          // ä»»åŠ¡çŠ¶æ€
  google.protobuf.Timestamp created_at = 7;       // åˆ›å»ºæ—¶é—´
  google.protobuf.Timestamp started_at = 8;       // å¼€å§‹æ—¶é—´
  google.protobuf.Timestamp completed_at = 9;     // å®Œæˆæ—¶é—´
  google.protobuf.Timestamp deadline = 10;        // æˆªæ­¢æ—¶é—´
  int32 priority = 11;                             // ä¼˜å…ˆçº§
  int32 retry_count = 12;                          // é‡è¯•æ¬¡æ•°
  int32 max_retries = 13;                          // æœ€å¤§é‡è¯•æ¬¡æ•°
  string error_message = 14;                       // é”™è¯¯ä¿¡æ¯
}

// è·å–ä»»åŠ¡è¯¦æƒ…è¯·æ±‚
message GetTaskRequest {
  string task_id = 1;                              // ä»»åŠ¡ID
}

// è·å–ä»»åŠ¡è¯¦æƒ…å“åº”
message GetTaskResponse {
  TaskInfo task = 1;                               // ä»»åŠ¡ä¿¡æ¯
  nspass.model.v1.TaskMessage task_message = 2;   // ä»»åŠ¡æ¶ˆæ¯
  nspass.model.v1.TaskResult result = 3;          // ä»»åŠ¡ç»“æœ
}

// å–æ¶ˆä»»åŠ¡è¯·æ±‚
message CancelTaskRequest {
  string task_id = 1;                              // ä»»åŠ¡ID
  string reason = 2;                               // å–æ¶ˆåŸå› 
}

// å–æ¶ˆä»»åŠ¡å“åº”
message CancelTaskResponse {
  bool success = 1;                                // æ˜¯å¦æˆåŠŸ
  string error_message = 2;                        // é”™è¯¯ä¿¡æ¯
}

// è·å–ç›‘æ§æ•°æ®è¯·æ±‚
message GetMetricsRequest {
  string agent_id = 1;                             // Agent ID
  nspass.model.v1.MetricsType metrics_type = 2;   // ç›‘æ§ç±»å‹
  google.protobuf.Timestamp start_time = 3;       // å¼€å§‹æ—¶é—´
  google.protobuf.Timestamp end_time = 4;         // ç»“æŸæ—¶é—´
}

// è·å–ç›‘æ§æ•°æ®å“åº”
message GetMetricsResponse {
  repeated MetricsData metrics = 1;                // ç›‘æ§æ•°æ®åˆ—è¡¨
}

// ç›‘æ§æ•°æ®
message MetricsData {
  string agent_id = 1;                             // Agent ID
  nspass.model.v1.MetricsType metrics_type = 2;   // ç›‘æ§ç±»å‹
  google.protobuf.Timestamp timestamp = 3;        // æ—¶é—´æˆ³
  nspass.model.v1.MetricsMessage data = 4;        // ç›‘æ§æ•°æ®
}

// è·å–ç›‘æ§æ•°æ®å†å²è¯·æ±‚
message GetMetricsHistoryRequest {
  string agent_id = 1;                             // Agent ID
  nspass.model.v1.MetricsType metrics_type = 2;   // ç›‘æ§ç±»å‹
  google.protobuf.Timestamp start_time = 3;       // å¼€å§‹æ—¶é—´
  google.protobuf.Timestamp end_time = 4;         // ç»“æŸæ—¶é—´
  int32 interval = 5;                              // é‡‡æ ·é—´éš”(ç§’)
  int32 page = 6;                                  // é¡µç 
  int32 page_size = 7;                             // æ¯é¡µå¤§å°
}

// è·å–ç›‘æ§æ•°æ®å†å²å“åº”
message GetMetricsHistoryResponse {
  repeated MetricsData metrics = 1;                // ç›‘æ§æ•°æ®åˆ—è¡¨
  int32 total = 2;                                 // æ€»æ•°
  int32 page = 3;                                  // å½“å‰é¡µ
  int32 page_size = 4;                             // æ¯é¡µå¤§å°
}

// Agentç®¡ç†æœåŠ¡
service AgentManagementService {
  // è·å–æ‰€æœ‰Agentåˆ—è¡¨
  rpc ListAgents(ListAgentsRequest) returns (ListAgentsResponse) {
    option (google.api.http) = {
      get: "/v1/agent/ws/agents"
    };
  };
  
  // è·å–Agentè¯¦æƒ…
  rpc GetAgent(GetAgentRequest) returns (GetAgentResponse) {
    option (google.api.http) = {
      get: "/v1/agent/ws/agents/{agent_id}"
    };
  };
  
  // å¼ºåˆ¶æ–­å¼€Agentè¿æ¥
  rpc DisconnectAgent(DisconnectAgentRequest) returns (DisconnectAgentResponse) {
    option (google.api.http) = {
      delete: "/v1/agent/ws/agents/{agent_id}"
    };
  };
  
  // æ‰¹é‡å‘é€ä»»åŠ¡
  rpc BroadcastTask(BroadcastTaskRequest) returns (BroadcastTaskResponse) {
    option (google.api.http) = {
      post: "/v1/agent/ws/broadcast"
      body: "*"
    };
  };
  
  // è·å–Agentç»Ÿè®¡ä¿¡æ¯
  rpc GetAgentStats(GetAgentStatsRequest) returns (GetAgentStatsResponse) {
    option (google.api.http) = {
      get: "/v1/agent/ws/stats"
    };
  };
}

// è·å–Agentåˆ—è¡¨è¯·æ±‚
message ListAgentsRequest {
  nspass.model.v1.NodeStatus status = 1;          // çŠ¶æ€è¿‡æ»¤
  int32 page = 2;                                  // é¡µç 
  int32 page_size = 3;                             // æ¯é¡µå¤§å°
  string keyword = 4;                              // å…³é”®è¯æœç´¢
}

// è·å–Agentåˆ—è¡¨å“åº”
message ListAgentsResponse {
  repeated AgentInfo agents = 1;                   // Agentåˆ—è¡¨
  int32 total = 2;                                 // æ€»æ•°
  int32 page = 3;                                  // å½“å‰é¡µ
  int32 page_size = 4;                             // æ¯é¡µå¤§å°
}

// Agentä¿¡æ¯
message AgentInfo {
  string agent_id = 1;                             // Agent ID
  string name = 2;                                 // Agentåç§°
  nspass.model.v1.NodeStatus status = 3;          // çŠ¶æ€
  string version = 4;                              // ç‰ˆæœ¬
  google.protobuf.Timestamp last_heartbeat = 5;   // æœ€åå¿ƒè·³æ—¶é—´
  google.protobuf.Timestamp connected_at = 6;     // è¿æ¥æ—¶é—´
  bool is_connected = 7;                           // æ˜¯å¦è¿æ¥
  string session_id = 8;                           // ä¼šè¯ID
  map<string, string> metadata = 9;               // å…ƒæ•°æ®
  int32 active_tasks = 10;                         // æ´»è·ƒä»»åŠ¡æ•°
  int32 total_tasks = 11;                          // æ€»ä»»åŠ¡æ•°
  int32 failed_tasks = 12;                         // å¤±è´¥ä»»åŠ¡æ•°
}

// è·å–Agentè¯¦æƒ…è¯·æ±‚
message GetAgentRequest {
  string agent_id = 1;                             // Agent ID
}

// è·å–Agentè¯¦æƒ…å“åº”
message GetAgentResponse {
  AgentInfo agent = 1;                             // Agentä¿¡æ¯
  repeated TaskInfo recent_tasks = 2;              // æœ€è¿‘ä»»åŠ¡
  MetricsData latest_metrics = 3;                  // æœ€æ–°ç›‘æ§æ•°æ®
}

// å¼ºåˆ¶æ–­å¼€Agentè¿æ¥è¯·æ±‚
message DisconnectAgentRequest {
  string agent_id = 1;                             // Agent ID
  string reason = 2;                               // æ–­å¼€åŸå› 
}

// å¼ºåˆ¶æ–­å¼€Agentè¿æ¥å“åº”
message DisconnectAgentResponse {
  bool success = 1;                                // æ˜¯å¦æˆåŠŸ
  string error_message = 2;                        // é”™è¯¯ä¿¡æ¯
}

// æ‰¹é‡å‘é€ä»»åŠ¡è¯·æ±‚
message BroadcastTaskRequest {
  repeated string agent_ids = 1;                   // Agent IDåˆ—è¡¨
  nspass.model.v1.TaskMessage task = 2;           // ä»»åŠ¡æ¶ˆæ¯
}

// æ‰¹é‡å‘é€ä»»åŠ¡å“åº”
message BroadcastTaskResponse {
  int32 success_count = 1;                         // æˆåŠŸæ•°é‡
  int32 failed_count = 2;                          // å¤±è´¥æ•°é‡
  repeated string failed_agent_ids = 3;            // å¤±è´¥çš„Agent IDåˆ—è¡¨
  repeated string error_messages = 4;              // é”™è¯¯ä¿¡æ¯åˆ—è¡¨
}

// è·å–Agentç»Ÿè®¡ä¿¡æ¯è¯·æ±‚
message GetAgentStatsRequest {
  google.protobuf.Timestamp start_time = 1;       // å¼€å§‹æ—¶é—´
  google.protobuf.Timestamp end_time = 2;         // ç»“æŸæ—¶é—´
}

// è·å–Agentç»Ÿè®¡ä¿¡æ¯å“åº”
message GetAgentStatsResponse {
  int32 total_agents = 1;                          // æ€»Agentæ•°
  int32 online_agents = 2;                         // åœ¨çº¿Agentæ•°
  int32 offline_agents = 3;                        // ç¦»çº¿Agentæ•°
  int32 total_tasks = 4;                           // æ€»ä»»åŠ¡æ•°
  int32 completed_tasks = 5;                       // å·²å®Œæˆä»»åŠ¡æ•°
  int32 failed_tasks = 6;                          // å¤±è´¥ä»»åŠ¡æ•°
  int32 pending_tasks = 7;                         // å¾…å¤„ç†ä»»åŠ¡æ•°
  double average_response_time = 8;                // å¹³å‡å“åº”æ—¶é—´
  map<string, int32> tasks_by_type = 9;            // æŒ‰ç±»å‹ç»Ÿè®¡çš„ä»»åŠ¡æ•°
  map<string, int32> agents_by_status = 10;        // æŒ‰çŠ¶æ€ç»Ÿè®¡çš„Agentæ•°
}


